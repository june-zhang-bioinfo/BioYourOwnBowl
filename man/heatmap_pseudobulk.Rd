% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/customized_vis.R
\name{heatmap_pseudobulk}
\alias{heatmap_pseudobulk}
\title{Generate Patient-Level Expression Heatmap with Z-scores}
\usage{
heatmap_pseudobulk(
  object,
  features,
  groups,
  idents = NULL,
  pseudobulk_column = NULL,
  colors = NULL,
  cluster_rows = FALSE,
  cluster_columns = FALSE,
  show_column_names = FALSE,
  heatmap_title = "Z-score",
  color_range = c(-2, 0, 2),
  color_palette = c("#4575b4", "white", "#d73027"),
  annotation_height = unit(4, "mm")
)
}
\arguments{
\item{object}{A Seurat object containing expression data and metadata}

\item{features}{Character vector of gene names to include in the heatmap}

\item{groups}{Character vector specifying the order of cohort/timepoint groups.
This defines both which groups to include and their display order.}

\item{idents}{Character string specifying the metadata column containing
cohort/timepoint information. If NULL, defaults to "cohort_tp".}

\item{pseudobulk_column}{Character string specifying the metadata column containing
pseudobulk. If NULL, defaults to "Patient".}

\item{colors}{Named vector of colors for each cohort/timepoint group. Names must
match the values in the idents If NULL, colors will be automatically
generated from a standard palette.}

\item{cluster_rows}{Logical indicating whether to cluster rows (genes).
Default is FALSE.}

\item{cluster_columns}{Logical indicating whether to cluster columns (samples).
Default is FALSE.}

\item{show_column_names}{Logical indicating whether to show sample names.
Default is FALSE.}

\item{heatmap_title}{Character string for the heatmap legend title.
Default is "Z-score".}

\item{color_range}{Numeric vector of length 3 specifying the values for
(min, center, max) of the color scale. Default is c(-2, 0, 2).}

\item{color_palette}{Character vector of length 3 specifying colors for
(min, center, max). Default is c("#4575b4", "white", "#d73027").}

\item{annotation_height}{Unit object specifying the height of the annotation bar.
Default is unit(4, "mm").}
}
\value{
A ComplexHeatmap object
}
\description{
This function creates a heatmap showing gene expression z-scores aggregated
at the patient level. Expression values are first averaged per patient within
each cohort/timepoint, then z-score normalized across all samples.
}
\details{
The function performs the following steps:
\enumerate{
\item Extracts normalized expression data for specified genes
\item Averages expression per gene, per patient, per cohort/timepoint
\item Computes z-scores across all samples for each gene (row-wise)
\item Orders samples according to the specified group order
\item Creates a heatmap with cohort annotations
}

Z-scores are calculated as: \deqn{z = (x - mean(x)) / sd(x)}
where x represents expression values across all samples for a given gene.
NA values (from genes with constant expression) are replaced with 0.

If colors are not provided, the function automatically generates colors using
a standard palette based on the unique values in the cohort column.
}
\examples{
\dontrun{
# Basic usage with auto-generated colors
heatmap_pseudobulk(
  object = object,
  features = c("CD3D", "CD8A", "IFNG"),
  groups = c("Chronic Pre-DAA", "ACTG Pre-DAA", "SR Pre-resolution")
)

# With custom colors
my_colors <- c(
  "Chronic Pre-DAA" = "#F8A19FB2",
  "ACTG Pre-DAA" = "#2ED9FFB2",
  "SR Pre-resolution" = "#FEAF16B2"
)

heatmap_pseudobulk(
  object = object,
  features = marker_genes,
  groups = c("Chronic Pre-DAA", "ACTG Pre-DAA", "SR Pre-resolution"),
  colors = my_colors,
  cluster_rows = TRUE
)

# With custom metadata columns
heatmap_pseudobulk(
  object = object,
  features = marker_genes,
  groups = c("Group1", "Group2", "Group3"),
  idents = "treatment_group",
  pseudobulk_column = "sample_id"
)
}

}
