% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/seurat_utils.R
\name{optimize_single_cell}
\alias{optimize_single_cell}
\title{Optimize Single Cell RNA-seq Analysis}
\usage{
optimize_single_cell(
  object = NULL,
  normalization.method = "LogNormalize",
  vf.method = "vst",
  model.use = "linear",
  pseudobulk_var = "patient_tp_mutation",
  pseudo_cutoff = 30,
  colors = NULL,
  mt.cutoff = 25,
  nfeatures = 2000,
  harmony = FALSE,
  harmony_vars = NULL,
  reduction = "pca",
  improved_diff_quantile = 0.6,
  k_range = c(10, 20, 30),
  resolution_range = seq(0.1, 0.3, 0.1),
  min.dist = 0.4,
  seed = 17,
  gene_filter = 50,
  regress.out = NULL,
  clusters_min = 4,
  clusters_max = 13,
  min.pct = 0.3,
  log2fc_cutoff = log2(1.5),
  lower_bound_param = 1,
  higher_bound_param = 2,
  cluster_distribution_layers = NULL,
  cluster_distribution_layer_orders = NULL,
  out_dir = getwd(),
  features = NULL
)
}
\arguments{
\item{object}{A Seurat object.}

\item{normalization.method}{Method for normalization. Default is "LogNormalize". Please refer to Seurat::NormalizeData() for more options.}

\item{vf.method}{Method for variable feature selection. Options include "vst", "dispersion",
"pseudobulk", "sct", or "anchor". Default is "vst".}

\item{model.use}{Model to use for scaling. Default is "linear". Please refer to Seurat::ScaleData() for more options.}

\item{pseudobulk_var}{Variable name for pseudobulk aggregation. Default is "patient_tp_mutation".}

\item{pseudo_cutoff}{Minimum number of cells required for pseudobulk calculation. Default is 30.}

\item{colors}{Named vector of colors for plotting. Default is NULL.}

\item{mt.cutoff}{Maximum percent mitochondrial content threshold for cell filtering. Default is 25.}

\item{nfeatures}{Number of variable features to select. Default is 2000.}

\item{harmony}{Logical indicating whether to run Harmony batch correction. Default is FALSE.}

\item{harmony_vars}{Character vector of variable names to use for Harmony correction. e.g. run, experiment, patient. Default is NULL.}

\item{reduction}{Dimensionality reduction method to use ("pca" or "harmony"). Default is "pca".}

\item{improved_diff_quantile}{Quantile threshold for PC selection. Lower values select more PCs. Default is 0.6.}

\item{k_range}{Vector of k values for nearest neighbor calculations. Default is c(10, 20, 30).}

\item{resolution_range}{Vector of resolution values for clustering. Default is seq(0.1, 0.3, 0.1).}

\item{min.dist}{Minimum distance parameter for UMAP. Default is 0.4.}

\item{seed}{Random seed for reproducibility. Default is 17.}

\item{gene_filter}{Minimum number of cells a gene must be expressed in to be retained. Default is 50.}

\item{regress.out}{Variables to regress out during scaling, e.g. proliterating genes. Default is NULL.}

\item{clusters_min}{Minimum number of clusters expected. Default is 4.}

\item{clusters_max}{Maximum number of clusters expected. Default is 13.}

\item{min.pct}{Minimum percentage expressed required for a gene to become DEG. Default is 0.3.}

\item{log2fc_cutoff}{Minimum log2fc required for a gene to become DEG. Default is log2(1.5).}

\item{lower_bound_param}{Lower bound parameter for low-quality cluster removal. To be more stringent, decrease this parameter. Default is 1.}

\item{higher_bound_param}{Upper bound parameter for low-quality cluster removal. To be more stringent, increase this parameter. Default is 2.}

\item{cluster_distribution_layers}{Character vector of metadata columns for cluster distribution plots. Default is NULL.}

\item{cluster_distribution_layer_orders}{List of factor level orders for distribution layers. Default is NULL.}

\item{out_dir}{Output directory for saving results. Default is current working directory.}

\item{features}{Data frame or list of selected features for visualization. Default is NULL.}
}
\value{
A processed Seurat object with clustering and dimensionality reduction completed.
The object is also saved as "object.rds" in the output directory.
}
\description{
This function performs a comprehensive single-cell RNA-seq analysis pipeline including
quality control, normalization, dimensionality reduction, clustering optimization, and
visualization. It automatically saves parameters, session info, and generates multiple
QC and analysis plots.
}
\details{
The function performs the following steps:
\enumerate{
\item Creates output directory and logs parameters and session info
\item Filters genes by expression threshold
\item Processes variable features using specified method
\item Runs PCA and optionally Harmony batch correction
\item Performs initial clustering at high resolution for QC
\item Removes low-quality clusters and high mitochondrial content cells
\item Re-processes variable features after QC
\item Selects optimal number of PCs
\item Runs clustering across multiple k and resolution parameters
\item Generates comprehensive visualizations including cluster distributions, dotplots, and heatmaps
}
}
\examples{
\dontrun{
# Basic usage
seurat_obj <- optimize_single_cell(
  object = my_seurat_object,
  out_dir = "results/analysis_v1"
)

# With Harmony batch correction
seurat_obj <- optimize_single_cell(
  object = my_seurat_object,
  harmony = TRUE,
  harmony_vars = c("batch", "donor"),
  out_dir = "results/harmony_analysis"
)

# Custom clustering parameters
seurat_obj <- optimize_single_cell(
  object = my_seurat_object,
  k_range = c(15, 25, 35),
  resolution_range = seq(0.2, 0.8, 0.2),
  clusters_min = 5,
  clusters_max = 15,
  out_dir = "results/custom_clustering"
)
}
}
